// Generated by CoffeeScript 1.8.0
(function() {
  var data;

  window.GEOCHAT_VIEW = {
    login: function(event) {
      if (event.keyCode === 13) {
        return AUTH.requestLogin($('#login').val(), $('#pass').val());
      }
    },
    loginSuccess: function() {
      GEOCHAT_COMPONENTS.connect(); 
      $("#loginForm").hide();
      $("#pass").val('');
      $("#rooms, #logout").show();
      return $("#localVideo").parent().show();
    },
    loginFail: function() {
      return $('#loginForm').addClass('fail');
    },
    logout: function() {
      AUTH.requestLogout();
      GEOCHAT_COMPONENTS.disconnect();
      $("#loginForm").show();
      return $("#rooms, #logout").hide();
    },
    addVideo: function(member, video) {
      return $("<div id=\"" + member + "\" class=\"cam\">\n	<p>" + member + "</p>\n	" + ($(video).prop('outerHTML')) + "\n</div>").appendTo('#cams').on('dragover dragenter', GEOCHAT_VIEW.dragCancel).on('drop', GEOCHAT_VIEW.dropFile);
    },
    writeChat: function(user, msg) {
      $('#out').append(user + ' : ' + msg + '<br>');
      return $('#out').scrollTop($('#out')[0].scrollHeight);
    },
    readChat: function(event) {
      var msg;
      msg = $(this).val();
      if (msg !== '' && event.keyCode === 13) {
        $(this).val('');
        if (typeof sendMessage === 'undefined') {
          return GEOCHAT_VIEW.writeChat('WARNING', 'You are not connected !');
        } else {
          GEOCHAT_VIEW.writeChat('me', msg);
          return sendMessage('messageChat', {
            user: AUTH.getMember(),
            message: msg
          });
        }
      }
    },
    dragCancel: function(event) {
      event.preventDefault();
      event.stopPropagation();
      return false;
    },
    dropFile: function(event) {
      var files, member;
      GEOCHAT_VIEW.dragCancel(event);
      member = this.id;
      files = event.originalEvent.dataTransfer.files;
      return FileTransfer.sendFile(member, files);
    }
  };

  $(function() {
    return window.AUTH.initialize();
  });

  $('#localMember').parent().on('dragover dragenter', GEOCHAT_VIEW.dragCancel).on('drop', GEOCHAT_VIEW.dropFile);

  $('#in').on('keyup', GEOCHAT_VIEW.readChat);

  if (window.FileReader) {
    console.log('FILEREADER');
  } else {
    console.log('NO FILEREADER !');
  }

  if (window.FileList) {
    console.log('FILELIST');
  } else {
    console.log('NO FILELIST !');
  }

  data = {
    data: [
      {
        text: 'Projet 1',
        children: [
          {
            text: 'ch 1 1',
            children: [
              {
                text: 'ch 1 1 1'
              }
            ]
          }, 'leaf'
        ]
      }, 'Projet 2'
    ]
  };

}).call(this);
