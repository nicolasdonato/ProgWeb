// Generated by CoffeeScript 1.8.0
(function() {
  window.GEOCHAT_VIEW = {
    login: function(event) {
      if (event.keyCode === 13) {
        return AUTH.requestLogin($('#login').val(), $('#pass').val());
      }
    },
    loginSuccess: function() {
      GEOCHAT_COMPONENTS.connect();
      $("#courses-div").hide();
      $("#classes-div").hide();
      GEOCHAT_VIEW.swap($("#loginForm"), $("#logout"));
      GEOCHAT_VIEW.swap($("#loginForm"), $("#courses-div"));
      GEOCHAT_VIEW.swap($("#loginForm"), $("#classes-div"));
      return $("#pass").val('');
    },
    loginFail: function() {
      return $('#loginForm').addClass('fail');
    },
    logout: function() {
      AUTH.requestLogout();
      GEOCHAT_COMPONENTS.disconnect();
      GEOCHAT_VIEW.swap($("#logout"), $("#loginForm"));
      GEOCHAT_VIEW.swap($('#courses-div'));
      GEOCHAT_VIEW.swap($('#classes-div'));
      GEOCHAT_VIEW.swap($('#geochat'));
      GEOCHAT_VIEW.swap($('#repository'));
      GEOCHAT_VIEW.swap($('#cams'));
      GEOCHAT_VIEW.swap($('#classes-details-submit-leave'));
      return GEOCHAT_VIEW.swap($('#classes-details-submit-end'));
    },
    addVideo: function(member, video) {
      return $("<div id=\"" + member + "\" class=\"cam\">\n	<p>" + member + "</p>\n	" + ($(video).prop('outerHTML')) + "\n</div>").appendTo('#cams').on('dragenter dragstart dragend dragleave dragover drag drop', GEOCHAT_VIEW.dragCancel).on('drop', GEOCHAT_VIEW.dropFile);
    },
    deleteVideo: function(video) {
      return $(video).parent().remove();
    },
    writeChat: function(user, msg) {
      $('#out').append(user + ' : ' + msg + '<br>');
      return $('#out').scrollTop($('#out')[0].scrollHeight);
    },
    readChat: function(event) {
      var msg;
      msg = $(this).val();
      if (msg !== '' && event.keyCode === 13) {
        $(this).val('');
        GEOCHAT_VIEW.writeChat('moi', msg);
        return CHAT.sendMessage('messageChat', {
          user: AUTH.getMember(),
          message: msg
        });
      }
    },
    dragCancel: function(event) {
      console.log('dragover');
      event.preventDefault();
      event.stopPropagation();
      return false;
    },
    dropFile: function(event) {
      var files, member;
      member = this.id;
      files = event.originalEvent.dataTransfer.files;
      return FILE_TRANSFER.sendFile(member, files);
    },
    join: function() {
      $('#geochat').hide();
      $('#repository').hide();
      GEOCHAT_VIEW.swap($('#courses-div'), $('#geochat'));
      GEOCHAT_VIEW.swap($('#classes-div'), $('#repository'));
      GEOCHAT_VIEW.show($('#cams'));
      GEOCHAT_VIEW.show($('classes-details-submit-leave'));
      GEOCHAT_VIEW.show($('classes-details-submit-end'));
      return true;
    },
    leave: function() {
      GEOCHAT_VIEW.swap($('#geochat'), $('#courses-div'));
      GEOCHAT_VIEW.swap($('#repository'), $('#classes-div'));
      GEOCHAT_VIEW.swap($('#cams'));
      return true;
    },
    show: function(elem) {
      var cb;
//      console.log('show');
//      console.log(elem.selector);
      cb = (function(_this) {
        return function() {
          return elem.removeClass('showOpac');
        };
      })(this);
      return elem.show().addClass('showOpac').one('animationend', cb).one('webkitAnimationEnd', cb);
    },
    swap: function(elem, elem2) {
      var cb;
//      console.log('hide');
//      console.log(elem.selector);
      cb = (function(_this) {
        return function() {
//          console.log(elem.selector);
//          console.log(elem2.selector);
          elem.removeClass('hideOpac').hide();
          if (elem2) {
            return GEOCHAT_VIEW.show(elem2);
          }
        };
      })(this);
      return elem.addClass('hideOpac').one('animationend', cb).one('webkitAnimationEnd', cb);
    }
  };

  $(function() {
    window.AUTH.initialize();
    $('#localMember').parent().on('dragover dragenter', GEOCHAT_VIEW.dragCancel).on('drop', GEOCHAT_VIEW.dropFile);
    $('#in').on('keyup', GEOCHAT_VIEW.readChat);
    $('#classes-details-submit-join').on('click', GEOCHAT_VIEW.join);
    $('#classes-details-submit-leave').on('click', GEOCHAT_VIEW.leave);
    $('#classes-details-submit-start').on('click', GEOCHAT_VIEW.join);
    return $('#classes-details-submit-end').on('click', GEOCHAT_VIEW.leave);
  });

}).call(this);
